# 一、产品需求文档（PRD）

## 1. 产品概述

### 1.1 产品名称

**ocr_pngtoexcel**

### 1.2 产品定位

一个支持 **图片表格 OCR → JSON → Excel → 在线编辑 → 下载** 的表格处理平台。

### 1.3 核心流程（端到端）

```
上传图片 → 触发 OCR 任务 → 获取 OCR JSON → 生成 Excel → 在线编辑 → 下载
```

### 1.4 核心目标

* 将图片中的表格结构化为 Excel
* 提供在线可编辑的 Excel 预览能力
* 支持多表格识别与导出

---

## 2. 页面结构与交互总览

页面由 **两个功能区** 构成，结构固定、职责清晰：

```
┌────────────────────────────┐
│ ① 图片上传区域              │
│  上传 + OCR 状态反馈         │
└────────────────────────────┘
│                              │
│ ② Excel 预览 / 编辑 / 下载   │
│  支持多表（多 Sheet）         │
│                              │
└────────────────────────────┘
```

---

## 3. 功能需求说明

---

## 3.1 第一部分：图片上传区域

### 3.1.1 功能说明

用户上传包含表格的图片，系统自动完成 OCR 识别并生成 Excel 数据。

---

### 3.1.2 上传能力要求

#### 支持格式

* png
* jpg
* jpeg

#### 上传规则

* 单次仅支持 **一张图片**
* 文件大小限制（如 ≤10MB）
* 不支持拖拽非图片文件

---

### 3.1.3 上传交互流程

1. 用户点击「上传图片」
2. 选择本地图片
3. 前端完成格式与大小校验
4. 上传成功后：

   * 显示图片名称
   * 自动触发 OCR 任务
   * 显示 OCR 处理状态

---

### 3.1.4 OCR 状态展示

OCR 过程为异步处理，前端需明确展示状态变化：

| 状态      | 说明             |
| ------- | -------------- |
| 上传成功    | 图片已成功上传        |
| OCR 处理中 | 表格识别进行中        |
| OCR 完成  | 识别完成，Excel 已生成 |
| OCR 失败  | 识别失败，可重试       |

状态展示应：

* 自动刷新
* 不需要用户手动点击刷新

---

### 3.1.5 OCR 接口交互（后端与 OCR 服务）

说明：前端只与本项目后端交互；OCR Token 与 OCR 服务细节仅在后端维护。完整接口流程见 `docs/03_architecture/ocr_integration.md`。

```
前端上传图片 → 后端上传至 OCR 服务 → 获取 job_id
前端轮询/长轮询任务状态 → 后端转发/聚合状态
任务 finished → 后端拉取 OCR JSON → 生成 Excel → 返回可预览数据/下载标识
```

### 3.1.6 异常处理

* OCR 失败时：

  * 显示失败提示
  * 提供「重新识别」入口
* OCR 服务不可用：

  * 显示系统异常提示

---

## 3.2 第二部分：Excel 预览、编辑与下载

---

### 3.2.1 功能说明

该区域用于展示 OCR 结果生成的 Excel，并支持：

* 表格预览
* 表格编辑
* 保存修改
* 下载 Excel 文件

---

### 3.2.2 多表识别与展示

#### 多表定义

* 单张图片中识别出 **多个独立表格**
* 每个表格对应 Excel 中的 **一个 Sheet**

---

#### 前端展示方式

* 提供 Sheet 切换（Tab / 下拉）
* 每个 Sheet 显示一个表格
* Sheet 名称可：

  * 默认由 OCR 提供
  * 或使用 Table_1 / Table_2

---

### 3.2.3 Excel 预览能力

#### 展示规则

* 第一行作为表头
* 表格横向可滚动
* 行列数无硬性限制（建议性能阈值控制）

---

#### 数据来源

* OCR 服务产出 **OCR JSON**（包含表格结构/内容）
* 后端将 OCR JSON **归一化为前端表格 JSON**，用于预览与编辑
* 保存/下载时，后端根据当前表格 JSON **生成 Excel 文件**
* 前端不直接读写 Excel 二进制文件

---

### 3.2.4 Excel 在线编辑能力（基础）

#### 支持范围

| 功能         | 是否支持 |
| ---------- | ---- |
| 单元格内容修改    | ✅    |
| 行新增 / 删除   | ✅    |
| 列新增 / 删除   | ✅    |
| 多 Sheet 编辑 | ✅    |

---

#### 编辑规则

* 点击单元格进入编辑态
* 修改即时更新前端状态
* **不自动保存**
* 必须手动点击「保存」

---

### 3.2.5 保存 Excel

#### 保存流程

1. 用户点击「保存」
2. 前端提交当前所有 Sheet 的表格数据
3. 后端生成新的 Excel 文件
4. 返回保存成功提示

📌 保存行为只影响导出的 Excel，不影响原始 OCR JSON（用于追溯/复现）

---

### 3.2.6 下载 Excel

#### 下载规则

* 点击「下载 Excel」
* 下载当前最新保存版本
* 文件名可基于原始图片名生成

---

## 4. 非功能性需求

### 4.1 性能要求

* OCR 处理为异步
* 表格渲染流畅
* 支持多表场景下的稳定切换

---

### 4.2 安全要求

* OCR Token 仅存在后端
* 文件访问统一通过接口
* 下载接口需校验任务有效性

---

### 4.3 可维护性要求

* OCR（外部服务）、JSON（中间结构）、Excel（导出结果）职责清晰
* 状态流转明确、可追踪

